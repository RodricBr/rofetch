#!/usr/bin/bash

# Version 2.0
# Updated IPv4 grepping, quote color, term output, and fixed errors.
# Might wanna add into the future: echo -n $(ip a | grep -Po "\d{1,4}\.\d{1,4}\.\d{1,4}\.\d{1,4}")

export LANG=C.UTF-8

LIPV4="$(ip a | grep -Po "\d{1,4}\.\d{1,4}\.\d{1,4}\.\d{1,4}" | grep -Ev "127.0.0.*" | head -n1)"
MSG_=$(curl -s "https://type.fit/api/quotes" 2>/dev/null | jq '.[] | [.text]' | grep -e '"' | sort -R | head -n1)
#AAA_=$(grep -Eo '["\x22].*["\x22]' -m1 /etc/lsb-release);
CHECK_VM_=$([[ $(grep -e "Windows" <<< $(lscpu)) ]]&& echo -e "WSL"; [[ $(grep -e "KVM" <<< $(lscpu)) ]]&& echo -e "Virtual Box")

VERME="\033[1;31m"
VERME2="\033[0;31m"
VERDE="\033[1;32m"
ROXO="\033[1;95m"
FIM="\033[0;00m"

# #################################################### #
# tem que ser no case, mas ta bugando alguma coisa e n to afim de debugar agora
function HELP_(){
  echo -e "\nUsage: ${0##*/} OPTIONS\n\n\
  Flags:\n\
    -h | --help          :: Shows this help message.\n\
    -b | --banner string :: Set custom ascii banner.\n"
  exit 0
}
[[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]&& HELP_

# Ideia:
# ./rofetch2 --banner r.txt

ARQ_="$2"
case "$ARQ_" in
  "-b"|"--banner") : ;;
  "") echo "File \"r.txt\" set as default"; ARQ_="r.txt" ;;
esac

IFS=$'\n' read -d '' -r -a lines < "$ARQ_" #r.txt

# #################################################### #

# ASCII: https://www.twitchquotes.com/ascii-art-generator Width: 25
echo -e "\n${VERME2}${lines[0]}"
echo -e "${lines[1]}  ${VERDE}$USER${FIM}@${VERDE}$HOSTNAME${FIM}"
echo -e "${VERME2}${lines[2]}"
echo -e "${lines[3]}  ${VERME}OS${FIM}:\t\t\t $(tr -d '"' <<< $(grep -Eo '["\x22].*["\x22]' -m1 /etc/lsb-release)) ($CHECK_VM_)" #$(awk -F '=' '/^NAME=/ {print $2}' /etc/os-release 2>&- | tr -d '"')" OR lsb_release -ds (but it's slower somehow)
echo -e "${VERME2}${lines[4]}  ${VERME}Term & Font${FIM}:\t\t $(echo -ne "$TERM ($(tty))") / ($(grep -Eo '["\x22].*["\x22]' /etc/default/console-setup | sed -n '4,1p' | tr -d '"'""))" # Antigo: echo -e "${VERME2}⣿⣿⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿  ${VERME}Term${FIM}:\t\t $(echo -ne "$TERM ($(tty))")"
echo -e "${VERME2}${lines[5]}  ${VERME}IPv4 (Local)${FIM}:\t $(wget -q --spider "https://www.google.com/"; [[ "$?" == "0" ]]&& echo -e "${LIPV4} ${VERDE}(Connected)${FIM}" || echo -e "${LIPV4} ${VERME}(Not connected)${FIM}")"
echo -e "${VERME2}${lines[6]}  ${VERME}Kernel${FIM}:\t\t $(uname -smr)"
echo -e "${VERME2}${lines[7]}  ${VERME}Uptime${FIM}:\t\t $(uptime -p | sed 's/up //g')" # Antigo: $(uptime | awk '{print $3" "$4"s"}' | tr -d ',')" # Antigo: echo $(uptime) | sed 's/^.\+up\ \+\([^,]*\).*/\1/g'
echo -e "${VERME2}${lines[8]}  $(free -m | awk 'NR==2{printf "\033[1;31mMemory Usage\033[0m: \t %s / %sMiB (%.2f%%)\n", $3,$2,$3*100/$2 }')"
echo -e "${VERME2}${lines[9]}  ${VERME}Shell${FIM}:\t\t $(VERR_=$($SHELL --version); echo ${VERR_%%(*})" # OLD: $(ps | awk '{print $4}' | sed -n 2p | tr -d '-') ${BASH_VERSION%(*}"
echo -e "${VERME2}${lines[10]}  $([[ "$DESKTOP_SESSION" == "" ]]&& echo -e "${VERME}DE${FIM}:\t\t\t No DE / Unknown" || echo -e "${VERME}DE${FIM}:\t\t\t $XDG_CURRENT_DESKTOP $DESKTOP_SESSION")" # Antigo: echo -e "${VERME2}⣿⣿⣿⠀⠀⠀⠀⢻⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿  ${VERME}DE${FIM}:\t\t\t [[ "$(echo $DESKTOP_SESSION)" == "" ]]&& echo -e "No DE / Unknown" || echo "$DESKTOP_SESSION""
echo -e "${VERME2}${lines[11]}"
echo -e "${lines[12]}${ROXO}${MSG_//\"}${FIM}"
unset IPV4 MSG_ VERME VERME2 VERDE ROXO FIM VERR_ CHECK_VM_ #AAA_
exit 0

"DEFAULT" <<EOF
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⠿⠿⠟⠛⠛⠛⠋⠉⠉⠉⠉⠀⠀⠀⠀⠀⢹⣿⣿⣿⣿⣿
⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿
⣿⣿⠀⠀⠀⠀⣿⣿⣿⣿⣿⣷⣶⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣿
⣿⣿⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿
⣿⣿⡇⠀⠀⠀⠘⠛⠛⠛⠛⠛⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿
⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿
⣿⣿⡇⠀⠀⠀⣶⣶⣆⠀⠀⠀⠲⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⡇⠀⠀⠀⢹⣿⣿⣆⠀⠀⠀⠈⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣇⠀⠀⠀⠘⣿⣿⣿⣧⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⠀⠀⠀⠀⢻⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿
⣿⣿⣿⣀⣀⡀⠀⠈⣿⣿⣿⣿⣷⡀⠀⠀⠀⠀⠀⠀⠙⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿
EOF
